@model Invoice_automation_V1.ViewModels.ChangePasswordViewModel

@{
    ViewData["Title"] = "Change Password";
}

<!-- Page Header -->
<div class="page-header mb-4">
    <div class="flex justify-between items-center flex-wrap gap-3">
        <div>
            <h2 class="font-bold mb-1">Change Password</h2>
            <p class="text-muted mb-0">Update your account password</p>
        </div>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i> Back to Profile
        </a>
    </div>
</div>

<div class="row justify-center">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <form asp-action="ChangePassword" method="post">
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                    <!-- Current Password -->
                    <div class="mb-4">
                        <label asp-for="CurrentPassword" class="form-label">Current Password <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <input asp-for="CurrentPassword" type="password" class="form-control password-input" placeholder="Enter current password" />
                            <button class="btn btn-outline-secondary toggle-password" type="button">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                        <span asp-validation-for="CurrentPassword" class="text-danger"></span>
                    </div>

                    <hr class="my-4" />

                    <!-- New Password -->
                    <div class="mb-4">
                        <label asp-for="NewPassword" class="form-label">New Password <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <input asp-for="NewPassword" type="password" class="form-control password-input" placeholder="Enter new password" id="newPassword" />
                            <button class="btn btn-outline-secondary toggle-password" type="button">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                        <span asp-validation-for="NewPassword" class="text-danger"></span>

                        <!-- Password Strength Indicator -->
                        <div id="passwordStrength" style="display: none; margin-top: 0.5rem;">
                            <div class="flex justify-between items-center mb-1">
                                <small class="font-semibold text-muted">Password Strength:</small>
                                <small class="font-semibold strength-text"></small>
                            </div>
                            <div style="height: 6px; background-color: #e5e7eb; border-radius: 50px; overflow: hidden;">
                                <div class="strength-bar-fill" style="height: 100%; width: 0%; border-radius: 50px; transition: all 0.3s ease;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Confirm Password -->
                    <div class="mb-4">
                        <label asp-for="ConfirmPassword" class="form-label">Confirm Password <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <input asp-for="ConfirmPassword" type="password" class="form-control password-input" placeholder="Confirm new password" />
                            <button class="btn btn-outline-secondary toggle-password" type="button">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                        <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                    </div>

                    <!-- Password Requirements -->
                    <div class="alert alert-info">
                        <h6 class="alert-heading mb-2">
                            <i class="bi bi-info-circle me-1"></i> Password Requirements
                        </h6>
                        <ul class="mb-0 ps-3 small">
                            <li>At least 6 characters long</li>
                            <li>Mix of uppercase and lowercase letters (recommended)</li>
                            <li>Include numbers and special characters (recommended)</li>
                        </ul>
                    </div>

                    <div class="flex justify-end gap-2 mt-4">
                        <a asp-action="Index" class="btn btn-outline-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-1"></i> Change Password
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Security Tips -->
        <div class="card mt-4">
            <div class="card-body">
                <h6 class="font-semibold mb-3">Security Tips</h6>
                <ul class="mb-0 text-muted small">
                    <li class="mb-2">Use a unique password that you don't use elsewhere</li>
                    <li class="mb-2">Avoid using personal information in your password</li>
                    <li class="mb-2">Change your password regularly</li>
                    <li>Never share your password with anyone</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Toggle password visibility
        document.querySelectorAll('.toggle-password').forEach(button => {
            button.addEventListener('click', function() {
                const input = this.parentElement.querySelector('.password-input');
                const icon = this.querySelector('i');

                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('bi-eye');
                    icon.classList.add('bi-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('bi-eye-slash');
                    icon.classList.add('bi-eye');
                }
            });
        });

        // Password strength meter
        const newPasswordInput = document.getElementById('newPassword');
        const passwordStrength = document.getElementById('passwordStrength');
        const strengthBarFill = document.querySelector('.strength-bar-fill');
        const strengthText = document.querySelector('.strength-text');

        function calculatePasswordStrength(password) {
            let strength = 0;

            if (password.length >= 6) strength += 20;
            if (password.length >= 10) strength += 20;
            if (/[a-z]/.test(password)) strength += 15;
            if (/[A-Z]/.test(password)) strength += 15;
            if (/[0-9]/.test(password)) strength += 15;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 15;

            return Math.min(strength, 100);
        }

        function getStrengthLabel(strength) {
            if (strength < 30) return { label: 'Weak', color: '#dc2626' };
            if (strength < 60) return { label: 'Fair', color: '#f59e0b' };
            if (strength < 80) return { label: 'Good', color: '#3b82f6' };
            return { label: 'Strong', color: '#059669' };
        }

        if (newPasswordInput) {
            newPasswordInput.addEventListener('input', function() {
                const password = this.value;

                if (password.length > 0) {
                    passwordStrength.style.display = 'block';

                    const strength = calculatePasswordStrength(password);
                    const { label, color } = getStrengthLabel(strength);

                    strengthBarFill.style.width = strength + '%';
                    strengthBarFill.style.backgroundColor = color;
                    strengthText.textContent = label;
                    strengthText.style.color = color;
                } else {
                    passwordStrength.style.display = 'none';
                }
            });
        }
    </script>
}
